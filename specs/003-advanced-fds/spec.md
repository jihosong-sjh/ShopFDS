# Feature Specification: 실시간 사기 탐지 시스템 실전 고도화

**Feature Branch**: `003-advanced-fds`
**Created**: 2025-11-18
**Status**: Draft
**Input**: User description: "실시간 사기 탐지 시스템 실전 고도화 - 현재 구축된 FDS 프레임워크를 실제 사기를 탐지할 수 있는 실전 시스템으로 고도화"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 디바이스 핑거프린팅 기반 사기 탐지 (Priority: P1)

보안 담당자가 동일한 사기 디바이스로부터의 반복적인 공격 시도를 자동으로 탐지하고 차단할 수 있다. 브라우저 속성(Canvas, WebGL, Audio 해싱), 하드웨어 특성(CPU 코어, 메모리, 스크린 해상도), 타임존/언어 불일치를 종합적으로 분석하여 디바이스 고유 지문을 생성한다.

**Why this priority**: 디바이스 핑거프린팅은 쿠키나 IP 주소 변경으로 우회할 수 없는 강력한 사기 탐지 수단이며, 다른 모든 고급 기능의 기반이 되는 핵심 데이터 수집 계층이다.

**Independent Test**: 동일한 브라우저에서 쿠키 삭제 후 재접속 시 동일한 디바이스 지문이 생성되는지 확인하고, VPN 변경 후에도 디바이스가 식별되는지 검증할 수 있다.

**Acceptance Scenarios**:

1. **Given** 사용자가 Chrome 브라우저에서 첫 접속 시, **When** 디바이스 핑거프린팅이 수집되면, **Then** Canvas/WebGL/Audio 해시, CPU 코어 수, 메모리 크기, 스크린 해상도를 포함한 고유 디바이스 ID가 생성된다.
2. **Given** 동일한 사용자가 쿠키를 삭제하고 IP를 변경한 후, **When** 재접속 시, **Then** 이전과 동일한 디바이스 ID가 매칭되어 "기존 디바이스"로 인식된다.
3. **Given** 한국 IP에서 접속하는 사용자의 브라우저 타임존이 미국으로 설정된 경우, **When** 타임존/언어 불일치 검사 시, **Then** 위험 점수에 15점이 가산되고 "타임존 불일치" 플래그가 기록된다.
4. **Given** 알려진 사기 디바이스 ID가 블랙리스트에 등록된 상태에서, **When** 해당 디바이스로 접속 시도 시, **Then** 즉시 거래가 차단되고 보안팀에 알림이 전송된다.

---

### User Story 2 - 행동 패턴 분석 기반 봇 탐지 (Priority: P1)

보안 시스템이 사용자의 마우스 움직임, 키보드 입력 패턴, 클릭스트림을 분석하여 자동화된 봇과 정상 사용자를 구별할 수 있다. 마우스 속도/가속도/곡률, 타이핑 속도/정정 빈도, 페이지 체류 시간 이상치를 실시간으로 모니터링한다.

**Why this priority**: 카드 테스팅(Card Testing) 공격의 80%가 자동화된 봇에 의해 수행되며, 행동 패턴 분석은 CAPTCHA 없이도 봇을 효과적으로 차단할 수 있는 핵심 기술이다.

**Independent Test**: Selenium 스크립트로 자동화된 주문 프로세스를 실행하여 봇으로 분류되는지 확인하고, 정상 사용자의 수동 주문과 행동 패턴 점수를 비교할 수 있다.

**Acceptance Scenarios**:

1. **Given** 사용자가 상품 페이지에서 마우스를 움직일 때, **When** 행동 패턴 분석 엔진이 작동하면, **Then** 마우스 이동 속도, 가속도, 곡률 값이 0.1초 단위로 수집되고 저장된다.
2. **Given** 사용자가 결제 정보를 입력할 때, **When** 키보드 타이핑 패턴이 분석되면, **Then** 평균 입력 속도(ms), 백스페이스 사용 빈도, 입력 리듬이 측정되어 봇 확률 점수가 계산된다.
3. **Given** 봇이 1초 이내에 상품 페이지 → 장바구니 → 결제 페이지로 이동한 경우, **When** 클릭스트림 분석 시, **Then** "비정상 빠른 체류 시간" 플래그가 설정되고 위험 점수 30점이 부여된다.
4. **Given** 마우스 움직임이 직선 경로(곡률 0에 가까움)로만 기록된 경우, **When** 행동 패턴 점수 계산 시, **Then** 봇 확률 85% 이상으로 판정되고 추가 인증(2FA)이 요구된다.

---

### User Story 3 - 네트워크 분석 기반 프록시/VPN 탐지 (Priority: P2)

시스템이 TOR/VPN/Proxy 사용을 자동으로 탐지하고, GeoIP 불일치, ASN 평판, DNS 역방향 조회를 통해 의심스러운 접속을 식별할 수 있다.

**Why this priority**: 전체 사기 거래의 60%가 프록시/VPN을 통해 발생하며, 네트워크 계층 분석은 디바이스/행동 패턴 우회 시도를 탐지하는 보완적 수단이다.

**Independent Test**: TOR 브라우저로 접속하여 "TOR 네트워크 사용" 플래그가 설정되는지 확인하고, 상용 VPN(NordVPN, ExpressVPN) 사용 시 탐지 여부를 검증할 수 있다.

**Acceptance Scenarios**:

1. **Given** 사용자가 TOR 네트워크를 통해 접속한 경우, **When** 네트워크 분석이 수행되면, **Then** "TOR 사용 감지" 플래그가 설정되고 위험 점수 40점이 부여된다.
2. **Given** 결제 정보의 카드 발급 국가가 한국인데 접속 IP의 GeoIP가 나이지리아인 경우, **When** 국가 불일치 검사 시, **Then** 위험 점수 50점이 부여되고 거래가 수동 검토 큐로 전송된다.
3. **Given** 사용자의 ASN(Autonomous System Number)이 알려진 데이터센터 IP 범위에 속하는 경우, **When** ASN 평판 조회 시, **Then** "데이터센터 IP 사용" 플래그가 설정되고 추가 검증이 요구된다.
4. **Given** 사용자 IP의 DNS 역방향 조회 결과가 "proxy.example.com"과 같은 프록시 도메인인 경우, **When** DNS 검증 시, **Then** 위험 점수 35점이 부여되고 거래가 차단된다.

---

### User Story 4 - 실전 사기 탐지 룰 30개 적용 (Priority: P1)

보안팀이 결제, 계정 탈취, 배송지 사기 유형별로 30개의 실전 검증된 룰을 적용하여 자동으로 사기를 탐지하고 차단할 수 있다. 카드 BIN 검증, 테스트 카드 패턴, 비밀번호 무차별 대입, 화물 전달 주소, 일회용 이메일 등 다양한 사기 시그니처를 실시간으로 검사한다.

**Why this priority**: 룰 기반 탐지는 ML 모델 대비 즉시 적용 가능하고 오탐률이 낮으며, 명백한 사기 패턴(테스트 카드, 알려진 사기 주소 등)을 100% 정확도로 차단할 수 있다.

**Independent Test**: 알려진 테스트 카드 번호(4111111111111111)로 결제 시도 시 즉시 차단되는지, 1분 내 동일 IP에서 5회 비밀번호 실패 시 계정 잠금이 작동하는지 검증할 수 있다.

**Acceptance Scenarios**:

1. **Given** 사용자가 카드 번호 "4111111111111111"(테스트 카드)로 결제 시도 시, **When** 카드 BIN 검증 룰이 실행되면, **Then** 즉시 "테스트 카드 사용 시도" 경고와 함께 거래가 차단된다.
2. **Given** 카드 발급 국가가 미국인데 결제 IP가 베트남인 경우, **When** 국가 매칭 룰이 실행되면, **Then** 위험 점수 45점이 부여되고 3D Secure 인증이 요구된다.
3. **Given** 동일 계정에서 1분 내 5회 비밀번호 실패가 발생한 경우, **When** 무차별 대입 탐지 룰이 실행되면, **Then** 계정이 15분간 잠금되고 사용자에게 이메일 알림이 전송된다.
4. **Given** 배송지 주소가 "서울시 강남구 테헤란로 123 (화물대리수령센터)"인 경우, **When** 알려진 화물 전달 주소 룰이 실행되면, **Then** "사기 배송지 의심" 플래그가 설정되고 거래가 차단된다.
5. **Given** 사용자 이메일이 "user123@tempmail.com"(일회용 이메일 도메인)인 경우, **When** 이메일 검증 룰이 실행되면, **Then** 위험 점수 20점이 부여되고 전화번호 인증이 추가로 요구된다.
6. **Given** 동일 디바이스에서 1시간 내 3개 이상의 다른 계정으로 로그인 시도 시, **When** 다중 계정 탐지 룰이 실행되면, **Then** 모든 관련 계정이 수동 검토 대상으로 표시된다.

---

### User Story 5 - 앙상블 ML 모델 기반 정밀 예측 (Priority: P2)

ML 엔지니어가 Random Forest, XGBoost, Autoencoder, LSTM 모델을 조합한 앙상블 시스템을 통해 사기 예측 정확도를 95% 이상으로 향상시킬 수 있다. 불균형 데이터 처리(SMOTE), Feature Importance 분석, GPU 가속 학습, 가중 투표 메커니즘을 활용한다.

**Why this priority**: 기존 Isolation Forest/LightGBM 모델의 정확도는 88%이며, 앙상블 모델 도입으로 오탐률을 50% 감소시키고 미탐률을 30% 감소시킬 수 있다.

**Independent Test**: 과거 6개월 사기 거래 데이터(레이블링됨)로 앙상블 모델을 학습시킨 후, 테스트 데이터셋에서 Precision/Recall/F1 Score가 개별 모델 대비 향상되었는지 검증할 수 있다.

**Acceptance Scenarios**:

1. **Given** 10,000건의 거래 데이터(사기 5%, 정상 95%)가 준비된 상태에서, **When** SMOTE 알고리즘으로 데이터 불균형을 처리하면, **Then** 학습 데이터셋이 사기 40%, 정상 60%로 리샘플링된다.
2. **Given** Random Forest 모델이 학습 완료된 상태에서, **When** Feature Importance 분석을 수행하면, **Then** 상위 10개 중요 특징(예: 디바이스 ID, 국가 불일치, 주문 금액)과 기여도 점수가 시각화된다.
3. **Given** XGBoost 모델이 GPU에서 학습 중일 때, **When** Early Stopping이 작동하면, **Then** Validation Loss가 3회 연속 개선되지 않을 경우 학습이 자동으로 중단되고 최적 모델이 저장된다.
4. **Given** 4개 모델(Random Forest, XGBoost, Autoencoder, LSTM)의 예측 결과가 [0.8, 0.7, 0.9, 0.6]인 경우, **When** 가중 투표(가중치: [0.3, 0.35, 0.25, 0.1])가 수행되면, **Then** 최종 사기 확률은 0.76으로 계산되고 "medium" 위험으로 분류된다.

---

### User Story 6 - 실시간 추론 최적화 및 Edge 배포 (Priority: P3)

개발팀이 모델 양자화, 배치 추론, WebAssembly 모델 배포를 통해 FDS 평가 시간을 100ms에서 50ms로 단축하고, 클라이언트 사이드에서 초기 필터링을 수행할 수 있다.

**Why this priority**: 현재 P95 평가 시간이 85ms이며, 50ms 목표 달성 시 사용자 체감 속도가 개선되고 서버 리소스를 30% 절감할 수 있다.

**Independent Test**: TorchServe로 배포된 모델에 1,000 TPS 부하를 가하여 P95 응답 시간이 50ms 이내인지 측정하고, WebAssembly 모델이 브라우저에서 정상 작동하는지 검증할 수 있다.

**Acceptance Scenarios**:

1. **Given** PyTorch 모델이 FP32 정밀도로 저장된 상태에서, **When** INT8 양자화를 수행하면, **Then** 모델 크기가 75% 감소하고 추론 속도가 2배 향상되며 정확도 손실은 1% 이내이다.
2. **Given** 동시에 100개의 거래 평가 요청이 들어온 경우, **When** 배치 추론 파이프라인이 작동하면, **Then** 100개 요청이 단일 배치로 묶여 한 번에 처리되고 평균 응답 시간이 30% 단축된다.
3. **Given** 경량화된 ML 모델이 WebAssembly로 컴파일된 상태에서, **When** 사용자 브라우저에서 모델이 로드되면, **Then** 디바이스 핑거프린팅 데이터가 클라이언트 사이드에서 분석되어 명백한 봇(점수 90 이상)은 서버 요청 전에 차단된다.

---

### User Story 7 - 설명 가능한 AI (XAI) 대시보드 (Priority: P2)

보안 담당자가 SHAP/LIME 분석을 통해 각 거래가 왜 사기로 판정되었는지 구체적인 근거를 실시간으로 확인할 수 있다. Feature 기여도, 위험 요인 분해, 의사결정 트리를 시각화한다.

**Why this priority**: 규제 준수(GDPR, 소비자 보호법)를 위해 자동화된 의사결정의 설명 가능성이 필수이며, 오탐 시 빠른 원인 파악으로 고객 불만을 50% 감소시킬 수 있다.

**Independent Test**: 특정 거래를 "high risk"로 판정한 후 XAI 대시보드에서 위험 요인 상위 5개를 확인하고, SHAP 값이 실제 feature 값과 일치하는지 검증할 수 있다.

**Acceptance Scenarios**:

1. **Given** 거래 ID "TXN-12345"가 위험 점수 85점으로 차단된 상태에서, **When** XAI 대시보드에서 해당 거래를 조회하면, **Then** 위험 요인 상위 5개(예: 타임존 불일치 +20점, TOR 사용 +40점, 테스트 카드 +25점)와 각 기여도가 막대 그래프로 표시된다.
2. **Given** SHAP 분석이 완료된 거래에서, **When** Feature 기여도 시각화를 요청하면, **Then** 워터폴 차트로 기본 위험 점수 30점에서 각 feature가 어떻게 최종 점수 85점까지 영향을 주었는지 단계별로 표시된다.
3. **Given** LIME 로컬 모델 근사가 수행된 상태에서, **When** 개별 예측 설명을 요청하면, **Then** "이 거래에서 '디바이스 ID 블랙리스트'와 '국가 불일치' feature를 제거하면 위험 점수가 40점으로 하락한다"는 가상 시나리오가 제시된다.

---

### User Story 8 - 자동화된 학습 파이프라인 및 데이터 드리프트 감지 (Priority: P3)

ML 엔지니어가 차지백 데이터, 사용자 신고, 수동 검토 결과를 자동으로 수집하여 모델을 재학습하고, 데이터 분포 변화를 실시간으로 모니터링하여 성능 저하 시 자동으로 재학습을 트리거할 수 있다.

**Why this priority**: 사기 패턴은 매월 20% 이상 변화하며, 수동 재학습 시 2주 지연이 발생하여 그 사이 사기 탐지율이 15% 하락한다. 자동화로 지연을 24시간 이내로 단축할 수 있다.

**Independent Test**: 차지백 데이터가 100건 수집되었을 때 자동 라벨링 파이프라인이 트리거되는지 확인하고, 모델 정확도가 3% 하락 시 재학습 알림이 발생하는지 검증할 수 있다.

**Acceptance Scenarios**:

1. **Given** 지난 7일간 차지백이 100건 발생한 상태에서, **When** 자동 라벨링 시스템이 작동하면, **Then** 해당 거래들이 "사기" 레이블로 자동 태그되고 학습 데이터셋에 추가된다.
2. **Given** 모델의 F1 Score가 0.92에서 0.88로 하락한 경우, **When** 데이터 드리프트 감지 시스템이 작동하면, **Then** "성능 저하 감지" 알림이 Slack으로 전송되고 자동 재학습이 예약된다.
3. **Given** 최근 1주일 거래의 평균 주문 금액 분포가 기존 대비 30% 변화한 경우, **When** 분포 변화 모니터링이 수행되면, **Then** "데이터 드리프트 경고" 플래그가 설정되고 Feature 재계산이 트리거된다.
4. **Given** False Positive가 1주일간 200건 발생한 상태에서, **When** A/B 테스트 자동화가 실행되면, **Then** 새 모델 버전이 트래픽 10%로 카나리 배포되고 성능이 자동으로 비교된다.

---

### User Story 9 - 외부 서비스 통합 검증 강화 (Priority: P2)

보안팀이 이메일 검증(EmailRep), 전화번호 검증(Numverify), 신용카드 BIN 데이터베이스, 소셜미디어 프로필, 다크웹 유출 데이터 체크를 통해 사용자 신원을 다층적으로 검증할 수 있다.

**Why this priority**: 계정 탈취 공격의 70%가 유출된 이메일/전화번호를 사용하며, 외부 서비스 통합으로 이를 사전에 차단하여 탈취 피해를 80% 감소시킬 수 있다.

**Independent Test**: 알려진 유출 이메일(예: "leaked@example.com")로 가입 시도 시 경고가 표시되는지, 허위 전화번호(예: "010-0000-0000") 사용 시 거부되는지 검증할 수 있다.

**Acceptance Scenarios**:

1. **Given** 사용자가 이메일 "fraud@spammer.com"으로 가입 시도 시, **When** EmailRep API 조회가 수행되면, **Then** "스팸/사기 이메일" 평판 점수 0/100이 반환되고 가입이 거부된다.
2. **Given** 사용자가 전화번호 "+1-555-0100"을 입력한 경우, **When** Numverify API로 검증하면, **Then** "유효하지 않은 전화번호" 응답과 함께 추가 인증이 요구된다.
3. **Given** 카드 BIN "424242"(테스트 카드)로 결제 시도 시, **When** BIN 데이터베이스 조회가 수행되면, **Then** "테스트 카드 사용" 플래그가 설정되고 거래가 즉시 차단된다.
4. **Given** 사용자 이메일 "user@example.com"이 다크웹 유출 데이터베이스에 존재하는 경우, **When** HaveIBeenPwned API 조회 시, **Then** "유출된 계정" 경고가 표시되고 비밀번호 재설정이 강제된다.

---

### Edge Cases

- **디바이스 핑거프린팅**:
  - Canvas API가 비활성화된 브라우저(Privacy Badger, Brave)에서 접속 시 대체 식별 방법은?
  - 모바일 앱(네이티브) 환경에서 브라우저 기반 핑거프린팅을 사용할 수 없는 경우 처리 방법은?
  - 동일 디바이스를 여러 사용자(가족)가 공유하는 경우 오탐 방지 전략은?

- **행동 패턴 분석**:
  - 장애인 사용자(예: 파킨슨병 환자)의 비정상적 마우스 움직임이 봇으로 오탐되는 경우 처리 방법은?
  - 모바일 터치 입력에서 마우스 움직임 데이터를 수집할 수 없는 경우 대안은?
  - 자동완성 기능으로 결제 정보를 입력한 경우(타이핑 없음) 봇 판정 오류 방지 방법은?

- **네트워크 분석**:
  - 합법적 VPN 사용자(예: 기업 VPN)를 사기범과 구별하는 기준은?
  - GeoIP 데이터베이스가 정확하지 않은 경우(오차 범위 10% 이상) 처리 방법은?
  - IPv6 주소에서 ASN 평판 조회가 지원되지 않는 경우 대안은?

- **사기 탐지 룰**:
  - 테스트 카드 번호와 실제 유사한 카드 번호가 우연히 일치하는 경우 처리 방법은?
  - 화물 전달 주소 DB가 최신화되지 않아 새로운 사기 주소를 탐지하지 못하는 경우 대응 방법은?
  - 일회용 이메일 도메인이 정상 서비스로 전환된 경우(예: 과거 tempmail.com → 현재 정식 이메일 서비스) 처리 방법은?

- **앙상블 ML 모델**:
  - 4개 모델 중 1개가 응답 실패(타임아웃, 에러) 시 앙상블 예측 처리 방법은?
  - 신규 사기 패턴이 등장하여 모든 모델이 탐지 실패(미탐)한 경우 긴급 대응 절차는?
  - GPU 자원 부족으로 XGBoost 학습이 지연되는 경우 Fallback 전략은?

- **실시간 추론 최적화**:
  - WebAssembly 모델이 구형 브라우저(IE11, Safari 10)에서 지원되지 않는 경우 처리 방법은?
  - 배치 추론 대기 중 긴급 거래(VIP 고객)가 발생한 경우 우선순위 처리 방법은?
  - 모델 양자화로 인한 정확도 손실이 허용 범위(1%)를 초과하는 경우 Rollback 기준은?

- **XAI 대시보드**:
  - SHAP 계산이 복잡한 거래(feature 1000개 이상)에서 5초 이상 소요되는 경우 타임아웃 처리 방법은?
  - 고객이 "왜 내 거래가 차단되었나요?" 질문 시 민감 정보(다른 사용자 데이터) 노출 방지 방법은?
  - LIME 로컬 모델 근사가 실제 모델과 20% 이상 차이 나는 경우 신뢰도 표시 방법은?

- **자동화된 학습 파이프라인**:
  - 차지백 데이터에 잘못된 레이블(정상 거래를 사기로 표시)이 포함된 경우 자동 교정 방법은?
  - 데이터 드리프트가 일시적 이벤트(블랙프라이데이 등)로 인한 것인 경우 재학습 스킵 기준은?
  - A/B 테스트 중 신규 모델이 기존 모델보다 오탐률이 50% 높은 경우 긴급 중단 조건은?

- **외부 서비스 통합**:
  - EmailRep API가 응답 지연(5초 이상) 시 거래 평가 타임아웃 처리 방법은?
  - Numverify API 할당량 초과로 전화번호 검증이 불가능한 경우 대체 검증 방법은?
  - 다크웹 유출 데이터베이스가 업데이트 중(점검)일 때 검증 스킵 여부 판단 기준은?

## Requirements *(mandatory)*

### Functional Requirements

#### 디바이스 핑거프린팅 시스템

- **FR-001**: 시스템은 사용자 접속 시 Canvas API, WebGL API, Audio API를 사용하여 브라우저 고유 해시를 생성해야 한다.
- **FR-002**: 시스템은 클라이언트 JavaScript를 통해 CPU 코어 수, 메모리 크기(navigator.deviceMemory), 스크린 해상도를 수집해야 한다.
- **FR-003**: 시스템은 사용자 브라우저의 타임존(Intl.DateTimeFormat().resolvedOptions().timeZone)과 GeoIP 국가가 불일치하는 경우 플래그를 설정해야 한다.
- **FR-004**: 시스템은 수집된 모든 디바이스 속성을 SHA-256 해싱하여 고유 디바이스 ID를 생성하고 데이터베이스에 저장해야 한다.
- **FR-005**: 시스템은 동일 디바이스 ID가 블랙리스트에 등록된 경우 즉시 거래를 차단하고 보안팀에 알림을 전송해야 한다.

#### 행동 패턴 분석 엔진

- **FR-006**: 시스템은 mousemove 이벤트를 0.1초 단위로 샘플링하여 X/Y 좌표, 속도, 가속도, 이동 방향을 기록해야 한다.
- **FR-007**: 시스템은 keydown/keyup 이벤트를 분석하여 평균 입력 속도(ms), 백스페이스 사용 빈도, 입력 리듬 변화를 측정해야 한다.
- **FR-008**: 시스템은 페이지 간 이동 시간(클릭스트림)을 추적하여 1초 미만의 비정상 빠른 전환을 탐지해야 한다.
- **FR-009**: 시스템은 마우스 움직임의 곡률(curvature) 값이 0.1 이하(직선 경로)인 경우 봇 확률 점수를 80점 이상으로 설정해야 한다.
- **FR-010**: 시스템은 행동 패턴 점수가 85점 이상인 경우 추가 인증(OTP, CAPTCHA)을 요구해야 한다.

#### 네트워크 분석 시스템

- **FR-011**: 시스템은 사용자 IP 주소를 TOR Exit Node 리스트와 비교하여 TOR 사용 여부를 탐지해야 한다.
- **FR-012**: 시스템은 GeoIP 데이터베이스를 사용하여 접속 IP의 국가와 결제 정보(카드 발급국)의 불일치를 검사해야 한다.
- **FR-013**: 시스템은 사용자 IP의 ASN을 조회하여 데이터센터 IP 범위에 속하는 경우 플래그를 설정해야 한다.
- **FR-014**: 시스템은 사용자 IP의 DNS 역방향 조회(PTR 레코드)를 수행하여 프록시/VPN 관련 도메인 키워드(proxy, vpn, tunnel 등)를 탐지해야 한다.
- **FR-015**: 시스템은 TOR 사용 시 위험 점수 40점, GeoIP 불일치 시 50점, ASN 데이터센터 시 35점을 부여해야 한다.

#### 실전 사기 탐지 룰 (30개)

**결제 관련 룰 (10개)**:

- **FR-016**: 시스템은 입력된 카드 번호가 알려진 테스트 카드 패턴(4111111111111111, 5555555555554444 등) 리스트에 존재하는 경우 즉시 거래를 차단해야 한다.
- **FR-017**: 시스템은 카드 BIN(앞 6자리)을 BIN 데이터베이스와 조회하여 발급 국가와 결제 IP 국가의 불일치를 검사해야 한다.
- **FR-018**: 시스템은 3D Secure 인증 없이 고액 거래(50만원 이상)가 시도되는 경우 3D Secure 인증을 강제해야 한다.
- **FR-019**: 시스템은 동일 카드 번호로 1시간 내 5회 이상 결제 실패 후 성공한 경우 "카드 테스팅" 플래그를 설정하고 거래를 차단해야 한다.
- **FR-020**: 시스템은 동일 IP에서 1시간 내 10개 이상의 다른 카드 번호로 결제 시도 시 "카드 테스팅 공격"으로 판정하고 IP를 차단해야 한다.
- **FR-021**: 시스템은 결제 금액이 상품 가격과 10% 이상 불일치하는 경우 "가격 조작 시도"로 판정하고 거래를 차단해야 한다.
- **FR-022**: 시스템은 카드 유효기간이 만료된 경우 즉시 거래를 거부해야 한다.
- **FR-023**: 시스템은 동일 세션에서 결제 정보를 10회 이상 수정한 경우 "사기 시도"로 판정하고 추가 인증을 요구해야 한다.
- **FR-024**: 시스템은 첫 거래에서 고액(100만원 이상) 결제 시도 시 "신규 고객 고액 결제"로 분류하고 수동 검토를 요청해야 한다.
- **FR-025**: 시스템은 동일 카드로 1일 내 3회 이상 환불 요청 시 "환불 사기" 의심으로 판정하고 계정을 잠금해야 한다.

**계정 탈취 관련 룰 (10개)**:

- **FR-026**: 시스템은 동일 IP에서 1분 내 동일 계정으로 5회 비밀번호 실패 시 계정을 15분간 잠금해야 한다.
- **FR-027**: 시스템은 사용자 세션 토큰이 동시에 2개 이상의 다른 IP에서 사용되는 경우 "세션 하이재킹" 의심으로 판정하고 모든 세션을 무효화해야 한다.
- **FR-028**: 시스템은 계정 정보(이메일, 전화번호, 배송지)가 1시간 내 모두 변경된 경우 "계정 탈취"로 판정하고 이메일 인증을 요구해야 한다.
- **FR-029**: 시스템은 동일 디바이스에서 1시간 내 3개 이상의 다른 계정으로 로그인 시도 시 "다중 계정 사용"으로 판정하고 모든 계정을 수동 검토 큐로 전송해야 한다.
- **FR-030**: 시스템은 로그인 위치가 이전 로그인 대비 물리적으로 1시간 내 이동 불가능한 거리(예: 서울 → 뉴욕)인 경우 "이상 로그인"으로 판정하고 2차 인증을 요구해야 한다.
- **FR-031**: 시스템은 계정 생성 후 1시간 내 고액 거래 시도 시 "신속 계정 탈취"로 판정하고 거래를 차단해야 한다.
- **FR-032**: 시스템은 비밀번호 재설정 요청이 1일 내 3회 이상 발생한 경우 "무차별 대입" 의심으로 판정하고 계정을 잠금해야 한다.
- **FR-033**: 시스템은 알려진 유출된 비밀번호 리스트(HaveIBeenPwned)에 존재하는 비밀번호 사용 시 비밀번호 재설정을 강제해야 한다.
- **FR-034**: 시스템은 User-Agent가 정상 로그인 시와 다른 경우(예: Chrome → curl) "비정상 접근"으로 판정하고 추가 인증을 요구해야 한다.
- **FR-035**: 시스템은 로그인 실패 후 즉시 비밀번호 재설정 요청 시 "자동화된 공격"으로 판정하고 CAPTCHA를 요구해야 한다.

**배송지 사기 관련 룰 (10개)**:

- **FR-036**: 시스템은 입력된 배송지 주소가 알려진 화물 전달 주소 데이터베이스(freight forwarder, package forwarding)에 존재하는 경우 거래를 차단해야 한다.
- **FR-037**: 시스템은 배송지 주소와 결제 정보(카드 청구지) 간 거리가 500km 이상인 경우 "배송지 불일치"로 판정하고 추가 검증을 요구해야 한다.
- **FR-038**: 시스템은 사용자 이메일 도메인이 일회용 이메일 서비스(tempmail.com, 10minutemail.com 등)에 속하는 경우 전화번호 인증을 추가로 요구해야 한다.
- **FR-039**: 시스템은 전화번호 형식이 유효하지 않거나(예: 010-0000-0000) 허위 번호 패턴에 해당하는 경우 거래를 거부해야 한다.
- **FR-040**: 시스템은 동일 배송지로 1일 내 5개 이상의 다른 계정에서 주문 시 "배송지 공유 사기"로 판정하고 모든 주문을 수동 검토해야 한다.
- **FR-041**: 시스템은 배송지가 PO Box(사서함)인 경우 고액 거래(30만원 이상) 시 추가 검증을 요구해야 한다.
- **FR-042**: 시스템은 신규 계정에서 배송지와 청구지가 완전히 다른 경우 "신규 계정 배송지 불일치"로 판정하고 전화 인증을 요구해야 한다.
- **FR-043**: 시스템은 배송지 입력 시간이 5초 미만(자동완성 또는 복사/붙여넣기)인 경우 "사전 준비된 주소" 의심으로 판정하고 위험 점수 10점을 부여해야 한다.
- **FR-044**: 시스템은 배송지 국가와 결제 IP 국가가 다르고 고액 거래(50만원 이상)인 경우 거래를 차단해야 한다.
- **FR-045**: 시스템은 동일 배송지로 1주일 내 10건 이상 주문 시 "리셀러 또는 사기"로 판정하고 계정을 수동 검토 큐로 전송해야 한다.

#### 앙상블 ML 모델 시스템

- **FR-046**: 시스템은 학습 데이터의 클래스 불균형(사기 5% 미만)을 SMOTE 알고리즘으로 처리하여 사기:정상 비율을 40:60으로 리샘플링해야 한다.
- **FR-047**: 시스템은 Random Forest, XGBoost, Autoencoder, LSTM 모델을 개별적으로 학습하고 각 모델의 Precision, Recall, F1 Score를 측정해야 한다.
- **FR-048**: 시스템은 4개 모델의 예측 결과를 가중 투표(Random Forest 30%, XGBoost 35%, Autoencoder 25%, LSTM 10%)로 결합하여 최종 사기 확률을 계산해야 한다.
- **FR-049**: 시스템은 Random Forest 모델의 Feature Importance를 계산하여 상위 10개 중요 특징과 기여도를 시각화해야 한다.
- **FR-050**: 시스템은 XGBoost 모델 학습 시 GPU를 사용하고 Validation Loss가 3회 연속 개선되지 않으면 Early Stopping을 적용해야 한다.
- **FR-051**: 시스템은 Autoencoder 모델에서 재구성 오차(Reconstruction Error)가 임계값(0.5) 이상인 거래를 이상 거래로 판정해야 한다.
- **FR-052**: 시스템은 LSTM 모델에서 사용자의 최근 10개 거래 시계열 패턴을 분석하여 급격한 행동 변화를 탐지해야 한다.

#### 실시간 추론 최적화

- **FR-053**: 시스템은 PyTorch/TensorFlow 모델을 INT8 양자화하여 모델 크기를 75% 감소시키고 추론 속도를 2배 향상시켜야 한다.
- **FR-054**: 시스템은 TorchServe 또는 TensorFlow Serving을 사용하여 모델을 배포하고 REST API를 제공해야 한다.
- **FR-055**: 시스템은 동시 요청이 50개 이상인 경우 배치 추론 파이프라인을 활성화하여 요청을 묶어 처리해야 한다.
- **FR-056**: 시스템은 경량화된 ML 모델을 WebAssembly로 컴파일하여 클라이언트 브라우저에서 실행 가능하도록 배포해야 한다.
- **FR-057**: 시스템은 WebAssembly 모델이 봇 확률 90점 이상을 탐지한 경우 서버 요청 없이 클라이언트 사이드에서 즉시 차단해야 한다.
- **FR-058**: 시스템은 모델 추론 시간(P95)을 50ms 이내로 유지해야 하며 초과 시 경고 알림을 전송해야 한다.

#### 설명 가능한 AI (XAI) 시스템

- **FR-059**: 시스템은 각 거래에 대해 SHAP(SHapley Additive exPlanations) 값을 계산하여 각 feature의 위험 점수 기여도를 분해해야 한다.
- **FR-060**: 시스템은 SHAP 분석 결과를 워터폴 차트로 시각화하여 기본 점수에서 최종 점수까지의 변화 과정을 표시해야 한다.
- **FR-061**: 시스템은 LIME(Local Interpretable Model-agnostic Explanations)을 사용하여 개별 거래에 대한 로컬 모델 근사를 생성해야 한다.
- **FR-062**: 시스템은 XAI 대시보드에서 위험 요인 상위 5개를 막대 그래프로 표시하고 각 요인의 점수를 명시해야 한다.
- **FR-063**: 시스템은 SHAP 계산이 5초 이상 소요되는 경우 타임아웃 처리하고 "분석 지연" 메시지를 표시해야 한다.

#### 자동화된 학습 파이프라인

- **FR-064**: 시스템은 차지백 데이터가 발생한 거래를 자동으로 "사기" 레이블로 태그하고 학습 데이터셋에 추가해야 한다.
- **FR-065**: 시스템은 사용자 신고 데이터를 수집하여 신고 횟수가 3회 이상인 거래를 "의심 사기"로 분류하고 수동 검토를 요청해야 한다.
- **FR-066**: 시스템은 보안팀의 수동 검토 결과(승인/거부)를 학습 데이터에 반영하여 피드백 루프를 구성해야 한다.
- **FR-067**: 시스템은 False Positive(정상 거래를 사기로 오탐)와 False Negative(사기를 정상으로 미탐) 건수를 실시간으로 추적하고 주간 리포트를 생성해야 한다.
- **FR-068**: 시스템은 모델의 F1 Score가 기준값(0.90) 대비 3% 이상 하락한 경우 "성능 저하" 알림을 Slack으로 전송해야 한다.
- **FR-069**: 시스템은 거래 데이터의 통계적 분포(평균, 분산)가 기존 대비 30% 이상 변화한 경우 "데이터 드리프트" 경고를 발생시켜야 한다.
- **FR-070**: 시스템은 데이터 드리프트 또는 성능 저하 감지 시 자동 재학습을 예약하고 완료 후 A/B 테스트를 시작해야 한다.

#### 외부 서비스 통합

- **FR-071**: 시스템은 EmailRep API를 호출하여 이메일 평판 점수(0-100)를 조회하고 20점 이하인 경우 가입을 거부해야 한다.
- **FR-072**: 시스템은 Numverify API를 사용하여 전화번호 유효성을 검증하고 "유효하지 않음" 응답 시 추가 인증을 요구해야 한다.
- **FR-073**: 시스템은 신용카드 BIN 데이터베이스를 조회하여 카드 발급 국가, 은행, 카드 종류(신용/체크) 정보를 확인해야 한다.
- **FR-074**: 시스템은 HaveIBeenPwned API를 호출하여 사용자 이메일이 유출 데이터베이스에 존재하는지 확인하고 존재 시 비밀번호 재설정을 강제해야 한다.
- **FR-075**: 시스템은 외부 API 호출이 5초 이상 소요되거나 실패한 경우 타임아웃 처리하고 Fallback 로직(기본 검증)을 실행해야 한다.

### Key Entities

- **DeviceFingerprint**: 디바이스 고유 식별 정보를 저장하는 엔티티. 속성: device_id(SHA-256 해시), canvas_hash, webgl_hash, audio_hash, cpu_cores, memory_size, screen_resolution, timezone, language, user_agent, created_at, last_seen_at, blacklisted(boolean), blacklist_reason.

- **BehaviorPattern**: 사용자 행동 패턴 데이터를 저장하는 엔티티. 속성: session_id, user_id, mouse_movements(JSON: [{timestamp, x, y, speed, acceleration, curvature}]), keyboard_events(JSON: [{timestamp, key, duration}]), clickstream(JSON: [{page, timestamp, duration}]), bot_score(0-100), created_at.

- **NetworkAnalysis**: 네트워크 분석 결과를 저장하는 엔티티. 속성: transaction_id, ip_address, geoip_country, geoip_city, asn, asn_organization, is_tor(boolean), is_vpn(boolean), is_proxy(boolean), dns_ptr_record, country_mismatch(boolean), risk_score, created_at.

- **FraudRule**: 사기 탐지 룰 정의를 저장하는 엔티티. 속성: rule_id, rule_name, rule_category(결제/계정/배송지), rule_description, risk_score, is_active(boolean), priority, created_at, updated_at.

- **RuleExecution**: 거래별 룰 실행 결과를 저장하는 엔티티. 속성: execution_id, transaction_id, rule_id, matched(boolean), triggered_at, metadata(JSON).

- **MLModelVersion**: ML 모델 버전 관리를 위한 엔티티. 속성: version_id, model_name(RandomForest/XGBoost/Autoencoder/LSTM), model_type, version_number, trained_at, accuracy, precision, recall, f1_score, is_active(boolean), model_path, hyperparameters(JSON).

- **EnsemblePrediction**: 앙상블 모델 예측 결과를 저장하는 엔티티. 속성: prediction_id, transaction_id, rf_score, xgb_score, autoencoder_score, lstm_score, ensemble_score(가중 평균), final_decision(allow/block/review), predicted_at.

- **FeatureImportance**: Feature 중요도 분석 결과를 저장하는 엔티티. 속성: analysis_id, model_version_id, feature_name, importance_score, rank, analyzed_at.

- **XAIExplanation**: XAI 분석 결과를 저장하는 엔티티. 속성: explanation_id, transaction_id, shap_values(JSON: [{feature, shap_value}]), lime_explanation(JSON), top_risk_factors(JSON: [{factor, contribution}]), generated_at.

- **DataDriftLog**: 데이터 드리프트 감지 로그를 저장하는 엔티티. 속성: log_id, detected_at, metric_name(평균 주문 금액, 거래 빈도 등), baseline_value, current_value, drift_percentage, alert_triggered(boolean).

- **RetrainingJob**: 모델 재학습 작업을 추적하는 엔티티. 속성: job_id, triggered_by(auto/manual), trigger_reason(데이터 드리프트/성능 저하/수동 요청), started_at, completed_at, status(pending/running/completed/failed), new_model_version_id, metrics(JSON).

- **ExternalServiceLog**: 외부 서비스 호출 로그를 저장하는 엔티티. 속성: log_id, service_name(EmailRep/Numverify/BIN/HaveIBeenPwned), request_data(JSON), response_data(JSON), response_time(ms), status_code, error_message, called_at.

- **BlacklistEntry**: 블랙리스트 항목을 저장하는 엔티티. 속성: entry_id, entry_type(device_id/ip_address/email/card_bin/shipping_address), entry_value, reason, added_by(user_id), added_at, expires_at.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 디바이스 핑거프린팅 시스템이 동일 디바이스를 95% 이상의 정확도로 재식별할 수 있다.
- **SC-002**: 행동 패턴 분석이 자동화된 봇을 90% 이상의 정확도로 탐지할 수 있다.
- **SC-003**: 네트워크 분석이 TOR/VPN/Proxy 사용을 85% 이상의 정확도로 탐지할 수 있다.
- **SC-004**: 30개의 사기 탐지 룰 적용 후 명백한 사기 패턴(테스트 카드, 알려진 사기 주소)의 차단율이 100%에 도달한다.
- **SC-005**: 앙상블 ML 모델의 F1 Score가 기존 모델(0.88) 대비 최소 7% 향상되어 0.95 이상을 달성한다.
- **SC-006**: 앙상블 모델 도입 후 False Positive(오탐)율이 기존 대비 50% 감소한다.
- **SC-007**: 앙상블 모델 도입 후 False Negative(미탐)율이 기존 대비 30% 감소한다.
- **SC-008**: 모델 추론 시간(P95)이 양자화 및 최적화 후 50ms 이내로 유지된다.
- **SC-009**: WebAssembly 클라이언트 사이드 모델이 명백한 봇(점수 90 이상)을 서버 요청 전에 차단하여 서버 부하를 20% 감소시킨다.
- **SC-010**: XAI 대시보드에서 보안 담당자가 거래 차단 사유를 3클릭 이내로 확인할 수 있다.
- **SC-011**: SHAP 분석 결과의 95%가 5초 이내에 생성된다.
- **SC-012**: 자동화된 학습 파이프라인이 데이터 드리프트 감지 후 24시간 이내에 모델 재학습을 완료한다.
- **SC-013**: 모델 성능 저하(F1 Score 3% 하락) 감지 시 1시간 이내에 보안팀에 알림이 전송된다.
- **SC-014**: 외부 서비스(EmailRep, Numverify, BIN DB, HaveIBeenPwned) 통합 후 계정 탈취 사기가 80% 감소한다.
- **SC-015**: 외부 API 호출 실패 또는 타임아웃 시 Fallback 로직이 자동으로 실행되어 거래 평가가 중단되지 않는다.
- **SC-016**: 전체 시스템 고도화 후 사기 탐지율(Recall)이 기존 82%에서 95% 이상으로 향상된다.
- **SC-017**: 전체 시스템 고도화 후 오탐률(False Positive Rate)이 기존 12%에서 6% 이하로 감소한다.
- **SC-018**: 보안팀의 수동 검토 작업량이 고도화 후 40% 감소한다.
- **SC-019**: 시스템 고도화로 인한 평균 거래 처리 시간 증가가 50ms 이내로 제한된다.
- **SC-020**: 고도화된 시스템이 1,000 TPS(Transactions Per Second) 부하에서 안정적으로 작동한다.

## Assumptions

1. **데이터 가용성**: 과거 6개월간의 거래 데이터(최소 100,000건)와 레이블링된 사기 데이터(최소 5,000건)가 ML 모델 학습에 사용 가능하다.
2. **브라우저 지원**: 사용자의 90% 이상이 Canvas/WebGL/Audio API를 지원하는 모던 브라우저(Chrome 90+, Firefox 88+, Safari 14+)를 사용한다.
3. **외부 API 가용성**: EmailRep, Numverify, BIN 데이터베이스, HaveIBeenPwned API가 99% 이상의 가용성을 보장하며 월 할당량이 충분하다(최소 100,000 요청/월).
4. **네트워크 데이터 정확성**: GeoIP 데이터베이스의 정확도가 90% 이상이며, TOR Exit Node 리스트가 매일 업데이트된다.
5. **GPU 리소스**: XGBoost 모델 학습 및 딥러닝 모델(Autoencoder, LSTM) 학습을 위한 GPU(최소 NVIDIA Tesla T4 또는 동급)가 사용 가능하다.
6. **모델 양자화 허용 오차**: INT8 양자화로 인한 모델 정확도 손실이 1% 이내로 제한된다.
7. **WebAssembly 브라우저 지원**: 사용자의 85% 이상이 WebAssembly를 지원하는 브라우저를 사용한다.
8. **사기 패턴 DB 최신성**: 테스트 카드 리스트, 화물 전달 주소 DB, 일회용 이메일 도메인 리스트가 매주 업데이트되어 최신 상태를 유지한다.
9. **차지백 데이터 지연**: 차지백 발생 후 자동 라벨링 시스템에 데이터가 반영되기까지 평균 3일 이내의 지연이 발생한다.
10. **보안팀 검토 용량**: 수동 검토가 필요한 거래가 일일 평균 200건 이하로 유지되어 보안팀의 처리 용량 내에 있다.
11. **데이터 프라이버시 규정 준수**: GDPR, CCPA 등 개인정보 보호 규정에 따라 디바이스 핑거프린팅 및 행동 패턴 수집에 대한 사용자 동의가 획득된다.
12. **A/B 테스트 트래픽**: 신규 모델 카나리 배포 시 전체 트래픽의 10%를 안전하게 라우팅할 수 있는 인프라가 구축되어 있다.

## Dependencies

1. **기존 FDS 시스템**: 현재 운영 중인 FDS 프레임워크(Isolation Forest, LightGBM 모델, 룰 엔진, CTI 커넥터)가 정상 작동하며 API가 문서화되어 있다.
2. **Redis 캐시**: 디바이스 핑거프린팅 조회, 행동 패턴 임시 저장, 룰 실행 결과 캐싱을 위한 Redis 클러스터가 구축되어 있다.
3. **PostgreSQL 데이터베이스**: 모든 엔티티(DeviceFingerprint, BehaviorPattern, NetworkAnalysis 등)를 저장할 수 있는 충분한 용량의 데이터베이스가 준비되어 있다.
4. **MLflow**: ML 모델 버전 관리, 실험 추적, 모델 레지스트리 기능을 위한 MLflow 서버가 설정되어 있다.
5. **TorchServe/TFServing**: 모델 배포 및 추론 서빙을 위한 TorchServe 또는 TensorFlow Serving 인프라가 구축되어 있다.
6. **Prometheus/Grafana**: 모델 성능 지표, 추론 시간, API 응답 시간 등을 모니터링하기 위한 시스템이 구축되어 있다.
7. **Slack 웹훅**: 알림(성능 저하, 데이터 드리프트, 재학습 완료 등)을 전송하기 위한 Slack 웹훅이 설정되어 있다.
8. **Celery/RabbitMQ**: 배치 작업(모델 재학습, SHAP 계산, 대량 데이터 처리)을 비동기로 처리하기 위한 작업 큐 시스템이 구축되어 있다.
9. **HTTPS/TLS**: 외부 API 호출 및 클라이언트-서버 통신이 암호화되어 있다.
10. **Admin Dashboard API**: 보안팀이 XAI 분석 결과, 룰 실행 로그, 블랙리스트를 조회하고 관리할 수 있는 API가 제공된다.

## Out of Scope

1. **완전 자동화된 사기 대응**: 고도화 범위는 탐지 및 분류까지이며, 법적 조치(경찰 신고, 소송) 자동화는 포함하지 않는다.
2. **실시간 비디오 분석**: 사용자 얼굴 인식, 영상 기반 행동 분석은 프라이버시 이슈로 제외한다.
3. **음성 통화 분석**: 전화 인증 시 음성 패턴 분석(보이스피싱 탐지)은 별도 프로젝트로 분리한다.
4. **블록체인 거래 추적**: 암호화폐 결제 시 블록체인 분석은 현재 범위에 포함하지 않는다.
5. **소셜미디어 프로필 심층 분석**: 소셜미디어 계정 존재 여부 확인은 포함하지만, 게시물 내용 분석이나 친구 관계 분석은 제외한다.
6. **다크웹 실시간 모니터링**: 다크웹 유출 데이터 체크는 기존 DB 조회만 포함하며, 실시간 다크웹 크롤링은 제외한다.
7. **생체 인증 통합**: 지문, 홍채, 얼굴 인식 등 생체 인증은 모바일 앱 네이티브 기능으로 별도 구현한다.
8. **다국어 NLP 분석**: 사용자 입력(배송 메모, 고객 문의) 텍스트의 자연어 처리 기반 사기 탐지는 제외한다.
9. **오프라인 매장 통합**: 온라인 이커머스 거래만 대상이며, 오프라인 POS 거래 연동은 제외한다.
10. **보험 연동**: 사기 피해 보상을 위한 보험사 연동 및 클레임 처리는 제외한다.
